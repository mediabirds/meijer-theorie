import{useStores as e,useApi as t,defineInterface as i}from"@directus/extensions-sdk";import{defineComponent as l,inject as o,ref as a,computed as n,watch as r,resolveComponent as d,openBlock as s,createElementBlock as u,createBlock as c,withCtx as f,createTextVNode as p,toDisplayString as v,resolveDynamicComponent as m,mergeProps as y,createCommentVNode as g}from"vue";var F=l({props:{collection:{type:String,required:!0},m2oField:{type:String,required:!0},presentationField:{type:String,required:!0},errorMsg:{type:String,default:"An error occurred while fetching the related item."}},setup(i){const l=o("values",a({})),d=a(null),s=a(!1),u=a(null),c=e().useRelationsStore(),f=e().useFieldsStore(),p=n((()=>{if(i.m2oField){const e=c.getRelationForField(i.collection,i.m2oField);return null==e?void 0:e.related_collection}})),v=n((()=>{var e;return(null===(e=f.getPrimaryKeyFieldForCollection(p.value))||void 0===e?void 0:e.field)||"id"})),m=n((()=>{if(p.value)return f.getField(p.value,i.presentationField)})),y=n((()=>l.value[i.m2oField])),g=n((()=>"object"==typeof y.value&&null!==y.value)),F=n((()=>"string"==typeof y.value||"number"==typeof y.value)),M=n((()=>g.value?y.value[v.value]:F.value?y.value:null)),h=t();return r(l,(()=>{!async function(){if(g.value)d.value=y.value[i.presentationField];else if(F.value){s.value=!0;try{const{data:e}=(await h.get(`/items/${p.value}/${y.value}`,{params:{fields:[i.presentationField]}})).data;d.value=e[i.presentationField]}catch(e){u.value=e}finally{s.value=!1}}else d.value=null}()}),{immediate:!0}),{value:d,loading:s,error:u,m2oPrimaryKey:M,fieldMeta:m}}});const M={class:"m2o-presentation"};F.render=function(e,t,i,l,o,a){const n=d("v-skeleton-loader"),r=d("v-notice");return s(),u("div",M,[e.loading?(s(),c(n,{key:0})):e.error?(s(),c(r,{key:1,type:"info"},{default:f((()=>[p(v(e.errorMsg),1)])),_:1})):e.fieldMeta?(s(),c(m(e.fieldMeta.meta&&e.fieldMeta.meta.interface?`interface-${e.fieldMeta.meta.interface}`:"interface-input"),y({key:2},e.fieldMeta.meta&&e.fieldMeta.meta.options||{},{autofocus:!1,disabled:!0,value:e.value,width:e.fieldMeta.meta&&e.fieldMeta.meta.width||"full",type:e.fieldMeta.type,collection:e.fieldMeta.collection,field:e.fieldMeta.field,"field-data":e.fieldMeta,"primary-key":e.m2oPrimaryKey,length:e.fieldMeta.schema&&e.fieldMeta.schema.max_length}),null,16,["value","width","type","collection","field","field-data","primary-key","length"])):g("v-if",!0)])},F.__file="src/interface.vue";var h=i({id:"m2o-presentation",name:"M2O Presentation",icon:"content_copy",description:"A presentation interface for displaying a field of a many-to-one field",component:F,options:t=>{var i,l,o,a;const n=e().useFieldsStore(),r=e().useRelationsStore(),d=n.getFieldsForCollection(t.collection).filter((e=>["string","integer","uuid"].includes(e.type))).filter((e=>{var i;return e.field!==(null===(i=n.getPrimaryKeyFieldForCollection(t.collection))||void 0===i?void 0:i.field)}));let s=[];if(null===(l=null===(i=t.field.meta)||void 0===i?void 0:i.options)||void 0===l?void 0:l.m2oField){const e=r.getRelationForField(t.collection,null===(a=null===(o=t.field.meta)||void 0===o?void 0:o.options)||void 0===a?void 0:a.m2oField);e&&(s=n.getFieldsForCollection(e.related_collection))}return[{field:"m2oField",type:"string",name:"M2O Field",meta:{interface:"select-dropdown",options:{choices:d.map((e=>({text:e.name,value:e.field})))}}},{field:"presentationField",type:"string",name:"Presentation Field",meta:{interface:"select-dropdown",options:{choices:s.map((e=>({text:e.name,value:e.field})))}}},{field:"errorMsg",type:"string",name:"Error Message",meta:{interface:"system-input-translated-string",options:{placeholder:"An error occurred while fetching the related item."}}}]},types:["alias"],localTypes:["presentation"],group:"presentation"});export{h as default};
